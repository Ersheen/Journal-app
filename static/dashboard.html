<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/static/dashboard styling.css">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="https://kit.fontawesome.com/4b2d151546.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="nav_bar">
        <h1>My Journal</h1>
        <div class='navbar_menu'>
            <h3>Add Entry</h3>
            <h3 onclick='redirect_to_view_page()'>View Journals</h3>
        </div>
        <h1 class="logout">Logout</h1>
    </div>
    <div class="user_content">
        <div id="toast-container" style="position: fixed; bottom: 20rem; right: 800px; z-index: 9999;"></div>
        <h1>Record your story</h1>
        <div class="user_div">
            <form class="my_form" hx-post="/api/post_entries" hx-target="#toast-container" hx-swap="beforeend">
                <input type="text" name="title" required placeholder="Title">
                <textarea name="content" required placeholder="Dear Diary..."></textarea>
                <button type="submit">Save</button>
            </form>
            <!-- <div class="response_div"></div> -->
        </div>
            <!-- <div class="about_journal">
                <div class="journal_title">
                    <h3 class="head_title"></h3>
                    <h5 class="date"></h5>
                </div>
                <p class="journal_content"></p>
            </div> -->
            
        
    </div>

    <script>
    

        // document.querySelector('.my_form').addEventListener('submit', async function(e) {
        //     e.preventDefault()
        // })


        function redirect_to_view_page() {
            window.location.href = '/view_journal'
        }
        
        document.querySelector('.my_form').addEventListener('htmx:afterRequest', function() {
            this.reset();
        });
        document.querySelector('.logout').addEventListener('click', async function(e) {
            const res = await fetch('/logout', {
                method: 'POST'
            })
            const data = await res.json()
            if (data.success) {
                window.location.href = '/login'
            }
        })


       document.addEventListener("htmx:afterSwap", (e) => {
        if (e.target.id === "toast-container") {
        const toast = e.detail.target.lastElementChild;

        if (!toast) return;

        // Delay before starting fade-out
        setTimeout(() => {
            toast.classList.add("fade-out");
        }, 2500); // Show for 2.5 seconds

        // Remove toast after fade-out animation completes
        toast.addEventListener("animationend", (event) => {
            if (event.animationName === "fadeout") {
            toast.remove();
            }
        });
        }
  });

    </script>
</body>
<script src="/static/script.js"></script>
</html>